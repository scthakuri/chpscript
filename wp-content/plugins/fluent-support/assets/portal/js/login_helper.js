document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("fstRegistrationForm"),t=document.getElementById("fstResetPasswordForm"),n=window.fluentSupportPublic.reCaptchaSettingsData;function s(e){e.classList.toggle("loading"),e.disabled=!e.disabled}function r(e,t,n){var r=document.getElementById(t);s(r),document.querySelectorAll(".error.text-danger").forEach((function(e){e.parentNode.parentNode.classList.remove("is-error"),e.remove()}));var i=new FormData(e),o=new XMLHttpRequest;o.open("POST",n,!0),o.responseType="json",o.setRequestHeader("X-WP-Nonce",window.fluentSupportPublic.nonce),o.onload=function(){if(200===this.status)if(this.response.redirect)window.location.href=this.response.redirect;else if(this.response.message){var t=document.createElement("div");t.classList.add("success","text-success"),t.innerHTML=this.response.message,e.appendChild(t)}else window.location.reload();else{var n=this.response.error;if((!n&&this.response.message||n&&403===this.response.data.status||422===this.status)&&(n=this.response.message),n){var i=document.createElement("div");i.classList.add("error","text-danger"),i.innerHTML=n,e.appendChild(i)}else for(var o in this.response){var a=document.getElementById("fst_"+o);if(a){var d=document.createElement("div");d.classList.add("error","text-danger"),d.innerHTML=Object.values(this.response[o])[0],a.parentNode.insertBefore(d,a.nextSibling),a.parentNode.parentNode.classList.add("is-error")}}}s(r)},o.send(i)}function i(e,t,s){e.preventDefault(),t.parentNode.parentNode.classList.toggle("hide"),document.querySelector(s).classList.toggle("hide"),"recaptcha_v3"===n.reCaptcha_version&&function(e){var t="yes"===n.formContainingReCaptcha.signup_form,s="yes"===n.formContainingReCaptcha.login_form;switch(e){case".fst_registration_wrapper":document.querySelector(".grecaptcha-badge").style.visibility=t?"visible":"hidden";break;case".fst_login_wrapper":document.querySelector(".grecaptcha-badge").style.visibility=s?"visible":"hidden";break;default:document.querySelector(".grecaptcha-badge").style.visibility="hidden"}}(s)}function o(e,t){var s=n.reCaptcha_version,r=n.siteKey,i=document.querySelector(e);if("recaptcha_v2"===s)var o='<div class="g-recaptcha" name="g-recaptcha-response" data-sitekey='+r+"></div><br>";else o='<input type="hidden" name="g-recaptcha-response" id='+t+"></input>",grecaptcha.ready((function(){grecaptcha.execute(r,{action:"submit"}).then((function(e){document.getElementById(t).value=e,"yes"===n.formContainingReCaptcha.login_form&&(document.querySelector(".grecaptcha-badge").style.visibility="visible")}))}));return i.insertAdjacentHTML("beforebegin",o),!0}e&&e.addEventListener("submit",(function(t){t.preventDefault(),r(e,"fst_submit",window.fluentSupportPublic.signup)})),t&&t.addEventListener("submit",(function(e){e.preventDefault(),r(t,"fst_reset_pass",window.fluentSupportPublic.resetPass)})),document.getElementById("fs_show_signup")&&document.getElementById("fs_show_signup").addEventListener("click",(function(e){i(e,this,".fst_registration_wrapper")})),document.getElementById("fst_login_form")&&"true"===n.is_enabled&&"yes"===n.formContainingReCaptcha.login_form&&o("#fst_login_form form .login-submit","g-recaptcha-login"),document.getElementById("fs_show_signup")&&"true"===n.is_enabled&&"yes"===n.formContainingReCaptcha.signup_form&&o(".fst_registration_wrapper form #fst_submit","g-recaptcha-signup"),document.getElementById("fs_show_reset_password")&&document.getElementById("fs_show_reset_password").addEventListener("click",(function(e){i(e,this,".fst_reset_pass_wrapper")})),document.getElementById("fs_show_login")&&document.getElementById("fs_show_login").addEventListener("click",(function(e){i(e,this,".fst_login_wrapper")}));var a=document.querySelectorAll("#fst_login_form form");if(a&&a[0]){var d=a[0];d.addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("wp-submit");s(t),document.querySelectorAll(".error.text-danger").forEach((function(e){e.parentNode.parentNode.classList.remove("is-error"),e.remove()}));var n=new FormData(a[0]);n.append("_support_login_nonce",window.fluentSupportPublic.fsupport_login_nonce);var r=new XMLHttpRequest;r.open("POST",window.fluentSupportPublic.login,!0),r.responseType="json",r.setRequestHeader("X-WP-Nonce",window.fluentSupportPublic.nonce),r.onload=function(){if(200===this.status)this.response.redirect?(window.location.href=this.response.redirect,setTimeout((function(){window.location.reload()}),1500)):window.location.href=window.fluentSupportPublic.redirect_fallback;else{var e=this.response.error;if((this.response&&403===this.status||422===this.status)&&(e=this.response.message),e){var n=document.getElementsByClassName("login-submit");n=n.length?n[0]:d;var r=document.createElement("div");r.classList.add("error","text-danger"),r.innerHTML=e,n.parentNode.insertBefore(r,n.nextSibling)}else for(var i in this.response){var o=document.getElementById("fst_"+i);if(o){var a=document.createElement("div");a.classList.add("error","text-danger"),a.innerHTML=Object.values(this.response[i])[0],o.parentNode.insertBefore(a,o.nextSibling),o.parentNode.parentNode.classList.add("is-error")}}}s(t)},r.send(n)}))}}));